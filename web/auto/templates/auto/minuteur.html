<!DOCTYPE html>
<html>
<head>
    <title>Minuteur</title>
</head>
<body>
    <h1>Minuteur</h1>
    <p>Temps restant : {{ temps_restant }}</p>

    <table id="minuteur">
        <tr>
            <th>Achat de carte de cr√©dit</th>
            <th>Montant</th>
            <th>Heure d'envoi</th>
        </tr>
    </table>

    <script src="https://unpkg.com/htmx.org/dist/htmx.js"></script>
    <script>
        function saveData() {
            var achat_carte_credit = document.getElementById('achat_carte_credit').checked;
            var montant = parseFloat(document.getElementById('montant').value);

            htmx.ajax('/compte/', 'POST', {
                'headers': {
                    'X-CSRFToken': "{{ csrf_token }}",
                },
                'data': {
                    'achat_carte_credit': achat_carte_credit,
                    'montant': montant
                }
            });
        }

        var countdown = setInterval(function() {
            var timeRemaining = document.getElementById('temps_restant').innerHTML;
            var timeParts = timeRemaining.split(':');
            var seconds = parseInt(timeParts[2]);
            var minutes = parseInt(timeParts[1]);
            var hours = parseInt(timeParts[0]);

            if (seconds === 0 && minutes === 0 && hours === 0) {
                saveData();
            } else if (seconds === 0 && minutes === 0) {
                hours--;
                minutes = 59;
                seconds = 59;
            } else if (seconds === 0) {
                minutes--;
                seconds = 59;
            } else {
                seconds--;
            }

            var newTimeRemaining = hours.toString().padStart(2, '0') + ':' +
                                   minutes.toString().padStart(2, '0') + ':' +
                                   seconds.toString().padStart(2, '0');

            document.getElementById('temps_restant').innerHTML = newTimeRemaining;
        }, 1000);
    </script>
</body>
</html>
